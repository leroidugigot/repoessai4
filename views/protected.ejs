<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Principale</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        .parent {
            display: grid;
            grid-template-columns: repeat(2, 0.75fr) repeat(8, 1fr) repeat(2, 0.75fr);
            grid-template-rows: repeat(12, 1fr);
            grid-column-gap: 0px;
            grid-row-gap: 0px;
        }
        .div-parent-left {
            background-image: url('/public/images/img/bgleft.png'); /* Chemin vers votre image */
            background-size: cover; /* Pour couvrir tout l’espace */
            background-position: center;
        }
        .div-parent-right {
            background-image: url('/public/images/img/bgright.png'); /* Chemin vers la seconde image */
            background-size: cover; /* Pour couvrir tout l’espace */
            background-position: center;
        }
        .div1 { grid-area: 1 / 1 / 2 / 3; }
        .div2 { grid-area: 1 / 3 / 2 / 9; }
        .div3 { grid-area: 1 / 9 / 2 / 13; }
        .div4 { grid-area: 2 / 3 / 3 / 11; }
        .div5 { grid-area: 2 / 1 / 4 / 3; }
        .div6 { grid-area: 4 / 1 / 11 / 3; }
        .div7 { grid-area: 11 / 1 / 13 / 3; }
        .div8 { grid-area: 2 / 11 / 9 / 13; }
        .div9 { grid-area: 9 / 11 / 11 / 13; }
        .div10 { grid-area: 11 / 11 / 13 / 13; }
        .div12 { grid-area: 2 / 3 / 13 / 11; }

        /* Masquer les barres de défilement */
        body::-webkit-scrollbar, 
        #mainContent::-webkit-scrollbar, 
        .div6::-webkit-scrollbar {
            display: none;
        }

        body {
            scrollbar-width: none;
            
        }
        

        .hidden {
            display: none;
        }

        body, #mainContent, .div6 {
            -ms-overflow-style: none;
        }

        #navbarHidden {
            transition: opacity 0.3s ease-in-out;
        }

        #navbarHidden.hidden {
            opacity: 0;
        }

        /* Style pour agrandir les divs en plein écran */
        .full-width {
            grid-column: 1 / 13;
        }

        #gptButton {
            position: relative;
            color: white;
            padding: 10px 15px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            z-index: 100; /* Assurez-vous qu'il est au-dessus des autres éléments */
        }

        #gptButton.visible {
            display: block;
        }
        
    </style>
</head>
<body class="bg-gray-100 text-gray-900">

    <div class="parent h-screen">
        <!-- Div1 - Logo -->
        <div class="div1 bg-gray-800 flex justify-center border border-gray-700 h-full">
            <%- include('partials/logoSite') %>
        </div>

        <!-- Div2 - Navbar -->
        <div class="div2 bg-gray-800 border border-gray-700 h-full">
            <%- include('partials/navbar') %>
        </div>

        <!-- Div3 - Logbar -->
        <div class="div3 bg-gray-800 text-white flex items-center justify-center border border-gray-700 h-full">
            <%- include('partials/logbar', { user }) %>
        </div>

        <!-- Div4 - Navbar Hidden -->
        <div id="navbarHidden" class="div4 z-50 border border-gray-700 h-full">
            <%- include('partials/navbarHidden') %>
        </div>

        <!-- Div5, Div6, Div7 encapsulés dans une div parent avec l'image de fond -->
        <div id="div-parent-left" class="div-parent-left bg-cover bg-center border border-gray-700 h-full" style="grid-area: 2 / 1 / 13 / 3;">
            <!-- Div5 - Lesson Online -->
            <div id="div5" class="h-20 bg-transparent">
                <%- include('partials/lessonOnLine') %>
            </div>

            <!-- Div6 - Chapter List -->
            <div id="div6" class="h-96 bg-transparent">
                <%- include('partials/chapterList') %>
            </div>

            <!-- Div7 - Dashboard -->
            <div id="div7" class="h-20 bg-transparent">
                <%- include('partials/dashboarddiv') %>
            </div>
        </div>

        <!-- Div8, Div9, Div10 encapsulés dans une div parent avec l'image de fond -->
        <div id="div-parent-right" class="div-parent-right bg-cover bg-center border border-gray-700 h-full" style="grid-area: 2 / 11 / 13 / 13;">
            <!-- Div8 - Connected Users -->
            <div id="div8" class="h-96 bg-transparent">
                <%- include('partials/connectedList') %>
            </div>

            <!-- Div9 - Referentials -->
            <div id="div9" class="h-20 bg-transparent">
                <%- include('partials/referentiels') %>
            </div>

            <!-- Div10 - Contact -->
            <div id="div10" class="h-20 bg-transparent relative">
                <%- include('partials/contact') %>
            </div>
        </div>

        <!-- Div11 - Input GPT -->
        <div id="gptInput" class="div12 hidden overflow-auto h-full">
            <%- include('partials/inputgpt') %> <!-- Contenu GPT ici -->
        </div>

        <!-- Div12 - Main Content -->
        <div id="mainContent" class="div12 border border-gray-700 overflow-y-auto h-full">
            <%- include('partials/contenus') %>
        </div>  
    </div>

    <button id="gptButton" class="absolute bottom-10 right-10 visible">
        <i id="gptIconInactive" class="fas fa-comment-dots"></i>
        <i id="gptIconActive" class="fas fa-comment-slash hidden"></i>
    </button>

    <button id="toggleButton" class="absolute top-10 right-10">
        Toggle Divs
    </button>

    <script>
        const navbar = document.getElementById('navbarHidden');
        const mainContent = document.getElementById('mainContent');
        const gptInput = document.getElementById('gptInput');
        let lastScrollTop = 0;
        let divsHidden = false;

        // Gestion du bouton GPT
        document.getElementById('gptButton').addEventListener('click', function() {
            // Basculer entre gptInput et mainContent
            mainContent.classList.toggle('hidden');
            gptInput.classList.toggle('hidden');
            
            // Basculer les icônes du bouton
            document.getElementById('gptIconActive').classList.toggle('hidden');
            document.getElementById('gptIconInactive').classList.toggle('hidden');
            
            // Si GPT est activé (affiche gptInput)
            if (!gptInput.classList.contains('hidden')) {
                // Restaurer les divs latérales
                const divsToShow = ['div-parent-left', 'div-parent-right'];
                divsToShow.forEach(divId => {
                    const div = document.getElementById(divId);
                    if (div) {
                        div.classList.remove('hidden');
                    }
                });
                
                // Retirer les classes full-width
                navbar.classList.remove('full-width');
                mainContent.classList.remove('full-width');
                divsHidden = false;
            }
        });

        // Gestion du défilement pour navbar
        function handleScroll() {
            let scrollTop = mainContent.scrollTop;
            if (scrollTop > lastScrollTop) {
                navbar.classList.add('hidden');
            } else {
                navbar.classList.remove('hidden');
            }
            lastScrollTop = scrollTop;
        }

        mainContent.addEventListener('scroll', handleScroll);

        // Gestion du bouton toggle pour les divs latérales
        document.getElementById('toggleButton').addEventListener('click', function() {
            // Ne rien faire si on est en mode GPT
            if (!gptInput.classList.contains('hidden')) {
                return;
            }

            const divsToHide = ['div-parent-left', 'div-parent-right'];
            
            if (!divsHidden) {
                // Masquer les divs
                divsToHide.forEach(divId => {
                    const div = document.getElementById(divId);
                    if (div) {
                        div.classList.add('hidden');
                    }
                });

                // Élargir la div principale
                mainContent.classList.add('full-width');
                navbar.classList.add('full-width');

                divsHidden = true;
            } else {
                // Afficher les divs
                divsToHide.forEach(divId => {
                    const div = document.getElementById(divId);
                    if (div) {
                        div.classList.remove('hidden');
                    }
                });

                // Réduire la div principale
                mainContent.classList.remove('full-width');
                navbar.classList.remove('full-width');

                divsHidden = false;
            }
        });
    </script>
</body>
</html>
